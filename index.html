<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Poker Score Calculator</title>
    <style>
        body { 
            font-family: sans-serif; 
            padding: 0 10px;
        }
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin-top: 10px; 
        }
        th, td { 
            border: 1px solid black; 
            padding: 5px; 
            text-align: center; 
            vertical-align: middle;
        }
        input[type="text"], input[type="number"] {
            width: 95%; 
            box-sizing: border-box; 
        }
        button {
            font-size: 0.9em;
            padding: 5px;
            margin: 2px; 
        }
        button:disabled { background-color: #eee; color: #aaa; border-color: #ccc; }
        .folded { background-color: #cccccc; }
        .info-board { background-color: #f0f0f0; padding: 10px; border-radius: 5px; margin-bottom: 15px; }
        .info-board h2, .info-board h3 { margin: 0; padding: 0; display: inline-block; font-size: 1em;}
        .info-board h3 { margin-left: 15px; }
    </style>
</head>
<body>
    <h1>Poker Score Calculator</h1>

    <p>
        初期チップ設定：
        <input type="number" id="startChip" value="100">
        <button onclick="initializeGame()">ゲーム開始</button>
    </p>

    <div class="info-board">
        <h2>Current Pot: <span id="totalPot">0</span></h2>
        <h3>Amount to Call: <span id="currentBet">0</span></h3>
        <h3>Raise Count: <span id="raiseCount">0</span> / 3</h3>
    </div>

    <table>
        <thead>
            <tr>
                <th>プレイヤー</th>
                <th>持ちチップ</th>
                <th>ベット額</th>
                <th>ベット / レイズ</th>
                <th>コール / フォールド</th>
                <th>ゲーム進行</th>
            </tr>
        </thead>
        <tbody id="playerTableBody">
        </tbody>
    </table>

    <div style="text-align: right; margin-top: 20px;">
        <button onclick="nextHand()">次のハンドへ (リセット)</button>
    </div>

    <script>
        const NUM_PLAYERS = 4;
        let playerChips = [];
        let playerBets = [];
        let playerFolded = [];
        let playerNames = Array(NUM_PLAYERS).fill("");
        let totalPot = 0;
        let gameStarted = false;
        let currentBet = 0;
        let raiseCount = 0;

        function updatePlayerName(playerNum) {
            const nameInput = document.getElementById(`playerName${playerNum}`);
            playerNames[playerNum] = nameInput.value;
        }

        function renderTable() {
            const tableBody = document.getElementById("playerTableBody");
            tableBody.innerHTML = ""; 

            for (let i = 0; i < NUM_PLAYERS; i++) {
                const tr = document.createElement("tr");
                if (playerFolded[i]) { tr.classList.add("folded"); }
                
                tr.innerHTML = `
                    <td><input 
                        type="text" 
                        id="playerName${i}" 
                        placeholder="プレイヤー${i + 1}" 
                        value="${playerNames[i]}" 
                        onchange="updatePlayerName(${i})">
                    </td>
                    <td id="playerChip${i}">${playerChips[i] !== undefined ? playerChips[i] : 'N/A'}</td>
                    <td id="playerBet${i}">${playerBets[i] !== undefined ? playerBets[i] : 0}</td>
                    <td>
                        <input type="number" id="betAmount${i}" placeholder="上乗せ額">
                        <button onclick="betOrRaise(${i})">Bet/Raise</button>
                    </td>
                    <td>
                        <button onclick="callBet(${i})">Call</button>
                        <button onclick="fold(${i})">Fold</button>
                    </td>
                    <td>
                        <button onclick="declareWinner(${i})" ${playerFolded[i] ? 'disabled' : ''}>👑 勝ち</button>
                    </td>
                `;
                tableBody.appendChild(tr);
            }
        }

        function initializeGame() {
            if (gameStarted && !confirm("ゲームをリセットして最初からやり直しますか？")) return;
            const startChip = Number(document.getElementById("startChip").value);
            playerChips = Array(NUM_PLAYERS).fill(startChip);
            playerNames = Array(NUM_PLAYERS).fill("");
            gameStarted = true;
            nextHand();
        }
        
        function callBet(playerNum) {
            if (!gameStarted || playerFolded[playerNum]) return;
            const amountToCall = currentBet - playerBets[playerNum];
            if (amountToCall <= 0) { alert("コールする必要はありません。"); return; }

            playerChips[playerNum] -= amountToCall;
            playerBets[playerNum] += amountToCall;
            totalPot += amountToCall;
            updateDisplay();
        }

        function betOrRaise(playerNum) {
            if (!gameStarted || playerFolded[playerNum]) return;
            const inputAmount = Number(document.getElementById(`betAmount${playerNum}`).value);
            if (inputAmount <= 0) { alert("正しい額を入力してください。"); return; }
            if (inputAmount > 100) {
                alert("ベット/レイズの上限は100です。");
                return;
            }

            if (currentBet > 0) {
                if (raiseCount >= 3) { alert("レイズは3回までです。コールまたはフォールドしてください。"); return; }
                raiseCount++;
            }
            
            const amountToCall = currentBet - playerBets[playerNum];
            const totalCommitAmount = amountToCall + inputAmount;

            playerChips[playerNum] -= totalCommitAmount;
            playerBets[playerNum] += totalCommitAmount;
            totalPot += totalCommitAmount;
            currentBet = playerBets[playerNum];
            document.getElementById(`betAmount${playerNum}`).value = "";
            updateDisplay();
        }

        function fold(playerNum) {
            if (!gameStarted || playerFolded[playerNum]) return;
            playerFolded[playerNum] = true;
            updateDisplay();
        }

        function declareWinner(winnerNum) {
            if (!gameStarted || playerFolded[winnerNum]) {
                alert("フォールドしたプレイヤーは勝者になれません。");
                return;
            }
            const winnerName = playerNames[winnerNum] || `プレイヤー${winnerNum + 1}`;
            
            if (confirm(`${winnerName} が勝ちでよろしいですか？\nポットの ${totalPot} チップが全て渡されます。`)) {
                playerChips[winnerNum] += totalPot;
                alert(`${winnerName} が ${totalPot} チップを獲得しました！`);
                nextHand();
            }
        }

        function nextHand() {
            if (!gameStarted) return;
            totalPot = 0;
            currentBet = 0;
            raiseCount = 0;
            playerBets = Array(NUM_PLAYERS).fill(0);
            playerFolded = Array(NUM_PLAYERS).fill(false);
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById("totalPot").innerText = totalPot;
            document.getElementById("currentBet").innerText = currentBet;
            document.getElementById("raiseCount").innerText = raiseCount;
            
            renderTable();
        }

        renderTable();
    </script>
</body>
</html>
