<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Poker Score Calculator</title>
    <style>
        body { font-family: sans-serif; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid black; padding: 8px; text-align: center; }
        button:disabled { background-color: #eee; color: #aaa; border-color: #ccc; }
        .folded { background-color: #cccccc; }
        .info-board { background-color: #f0f0f0; padding: 10px; border-radius: 5px; margin-bottom: 15px; }
        .info-board h2, .info-board h3 { margin: 0; padding: 0; display: inline-block; }
        .info-board h3 { margin-left: 20px; }
        .oya-row { background-color: #e0f7fa; } 
    </style>
</head>
<body>
    <h1>Poker Score Calculator</h1>

    <p>
        åˆæœŸãƒãƒƒãƒ—è¨­å®šï¼š
        <input type="number" id="startChip" value="100">
        <button onclick="initializeGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
    </p>

    <div class="info-board">
        <h2>Current Pot: <span id="totalPot">0</span></h2>
        <h3>Amount to Call: <span id="currentBet">0</span></h3>
        <h3>Raise Count: <span id="raiseCount">0</span> / 3</h3>
        <h3>ç¾åœ¨ã®è¦ª: <span id="oyaDisplay">æœªé¸æŠ</span></h3>
    </div>

    <table>
        <thead>
            <tr>
                <th>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</th>
                <th>æŒã¡ãƒãƒƒãƒ—</th>
                <th>ä»Šå›ã®ãƒ™ãƒƒãƒˆé¡</th>
                <th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                <th>çŠ¶æ³</th>
            </tr>
        </thead>
        <tbody id="playerTableBody">
            </tbody>
    </table>

    <div style="text-align: right; margin-top: 20px;">
        <button onclick="nextHand()">æ¬¡ã®ãƒãƒ³ãƒ‰ã¸ (ãƒªã‚»ãƒƒãƒˆ)</button>
    </div>

    <script>
        // === ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°å®šç¾©: ã‚²ãƒ¼ãƒ å…¨ä½“ã®çŠ¶æ…‹ã‚’ç®¡ç† ===
        const NUM_PLAYERS = 4; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®äººæ•°
        let playerChips = []; // å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æŒã¡ãƒãƒƒãƒ—
        let playerBets = []; // ç¾åœ¨ã®ãƒãƒ³ãƒ‰ã§ã®å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ™ãƒƒãƒˆé¡
        let playerFolded = []; // å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã—ãŸã‹ã©ã†ã‹ã®çŠ¶æ…‹
        let playerNames = Array(NUM_PLAYERS).fill(""); // å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åå‰
        let totalPot = 0; // ç¾åœ¨ã®ãƒãƒƒãƒˆã®åˆè¨ˆé¡
        let gameStarted = false; // ã‚²ãƒ¼ãƒ ãŒé–‹å§‹ã•ã‚ŒãŸã‹ã©ã†ã‹ã®çŠ¶æ…‹
        let currentBet = 0; // ç¾åœ¨ã®ã‚³ãƒ¼ãƒ«ã«å¿…è¦ãªãƒ™ãƒƒãƒˆé¡
        let raiseCount = 0; // ãƒ¬ã‚¤ã‚ºã•ã‚ŒãŸå›æ•°
        let oyaIndex = -1; // è¦ªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç•ªå· (-1ã¯æœªé¸æŠ)

        /**
         * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«ã€ãã®åå‰ã‚’é…åˆ—ã«ä¿å­˜ã™ã‚‹
         * @param {number} playerNum - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç•ªå· (0-3)
         */
        function updatePlayerName(playerNum) {
            const nameInput = document.getElementById(`playerName${playerNum}`);
            playerNames[playerNum] = nameInput.value;
        }

        /**
         * ç¾åœ¨ã®ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ã‚‚ã¨ã«ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å†æç”»ã™ã‚‹
         */
        function renderTable() {
            const tableBody = document.getElementById("playerTableBody");
            tableBody.innerHTML = ""; // ãƒ†ãƒ¼ãƒ–ãƒ«ã®å†…å®¹ã‚’ä¸€æ—¦ç©ºã«ã™ã‚‹

            // å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æƒ…å ±ã‚’ãƒ«ãƒ¼ãƒ—ã§ç”Ÿæˆã™ã‚‹
            for (let i = 0; i < NUM_PLAYERS; i++) {
                const tr = document.createElement("tr"); // 1ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†ã®ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œ(tr)ã‚’ä½œæˆ
                if (playerFolded[i]) { tr.classList.add("folded"); } // ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã—ã¦ã„ãŸã‚‰foldedã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸
                if (i === oyaIndex) { tr.classList.add("oya-row"); } // è¦ªã ã£ãŸã‚‰oya-rowã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸
                
                // 1è¡Œåˆ†ã®HTMLã‚’ç”Ÿæˆ
                tr.innerHTML = `
                    <td><input 
                        type="text" 
                        id="playerName${i}" 
                        placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i + 1}" 
                        value="${playerNames[i]}" 
                        onchange="updatePlayerName(${i})">
                    </td>
                    <td id="playerChip${i}">${playerChips[i] !== undefined ? playerChips[i] : 'N/A'}</td>
                    <td id="playerBet${i}">${playerBets[i] !== undefined ? playerBets[i] : 0}</td>
                    <td>
                        <input type="number" id="betAmount${i}" placeholder="ä¸Šä¹—ã›é¡">
                        <button onclick="betOrRaise(${i})">Bet/Raise</button>
                        <button onclick="callBet(${i})">Call</button>
                        <button onclick="fold(${i})">Fold</button>
                    </td>
                    <td>
                        <button onclick="setOya(${i})" ${oyaIndex !== -1 ? 'disabled' : ''}>è¦ªã«ã™ã‚‹</button>
                        <button onclick="declareWinner(${i})" ${playerFolded[i] ? 'disabled' : ''}>ğŸ‘‘ ã“ã®äººãŒå‹ã¡</button>
                    </td>
                `;
                tableBody.appendChild(tr); // ç”Ÿæˆã—ãŸè¡Œã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ 
            }
        }

        /**
         * ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ãã®å‡¦ç†ã€‚åˆæœŸãƒãƒƒãƒ—ã‚’å…¨å“¡ã«é…ã‚‹
         */
        function initializeGame() {
            if (gameStarted && !confirm("ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ")) return;
            const startChip = Number(document.getElementById("startChip").value);
            playerChips = Array(NUM_PLAYERS).fill(startChip);
            playerNames = Array(NUM_PLAYERS).fill("");
            gameStarted = true;
            nextHand(); // nextHandã‚’å‘¼ã‚“ã§ã‚²ãƒ¼ãƒ ã®æœ€åˆã®çŠ¶æ…‹ã«ã‚»ãƒƒãƒˆã™ã‚‹
        }

        /**
         * ã€Œè¦ªã«ã™ã‚‹ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ãã®å‡¦ç†
         * @param {number} playerNum - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç•ªå· (0-3)
         */
        function setOya(playerNum) {
            if (!gameStarted || oyaIndex !== -1) return;
            oyaIndex = playerNum;
            updateDisplay(); // è¡¨ç¤ºã‚’æ›´æ–°ã—ã¦è¦ªã®ãƒã‚¤ãƒ©ã‚¤ãƒˆãªã©ã‚’åæ˜ ã•ã›ã‚‹
        }
        
        /**
         * ã€ŒCallã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ãã®å‡¦ç†
         * @param {number} playerNum - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç•ªå· (0-3)
         */
        function callBet(playerNum) {
            if (!gameStarted || playerFolded[playerNum]) return;
            const amountToCall = currentBet - playerBets[playerNum];
            if (amountToCall <= 0) { alert("ã‚³ãƒ¼ãƒ«ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚"); return; }

            // ãƒãƒƒãƒ—ã‚’è¨ˆç®—
            playerChips[playerNum] -= amountToCall;
            playerBets[playerNum] += amountToCall;
            totalPot += amountToCall;
            updateDisplay(); // è¡¨ç¤ºã‚’æ›´æ–°
        }

        /**
         * ã€ŒBet/Raiseã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ãã®å‡¦ç†
         * @param {number} playerNum - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç•ªå· (0-3)
         */
        function betOrRaise(playerNum) {
            if (!gameStarted || playerFolded[playerNum]) return;
            const inputAmount = Number(document.getElementById(`betAmount${playerNum}`).value);
            if (inputAmount <= 0) { alert("æ­£ã—ã„é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"); return; }
            if (inputAmount > 100) {
                alert("ãƒ™ãƒƒãƒˆ/ãƒ¬ã‚¤ã‚ºã®ä¸Šé™ã¯100ã§ã™ã€‚");
                return;
            }

            // ã“ã‚ŒãŒãƒ™ãƒƒãƒˆã‹ãƒ¬ã‚¤ã‚ºã‹ã‚’åˆ¤æ–­
            if (currentBet > 0) { // èª°ã‹ãŒæ—¢ã«ãƒ™ãƒƒãƒˆã—ã¦ã„ã‚‹å ´åˆ -> ãƒ¬ã‚¤ã‚º
                if (raiseCount >= 3) { alert("ãƒ¬ã‚¤ã‚ºã¯3å›ã¾ã§ã§ã™ã€‚ã‚³ãƒ¼ãƒ«ã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã—ã¦ãã ã•ã„ã€‚"); return; }
                raiseCount++;
            }
            
            const amountToCall = currentBet - playerBets[playerNum]; // ç¾åœ¨ã®ãƒ™ãƒƒãƒˆé¡ã«è¿½ã„ã¤ããŸã‚ã®å·®é¡
            const totalCommitAmount = amountToCall + inputAmount; // å·®é¡ï¼‹ä»Šå›ã®ä¸Šä¹—ã›é¡

            // ãƒãƒƒãƒ—ã‚’è¨ˆç®—
            playerChips[playerNum] -= totalCommitAmount;
            playerBets[playerNum] += totalCommitAmount;
            totalPot += totalCommitAmount;
            currentBet = playerBets[playerNum]; // ã‚³ãƒ¼ãƒ«ã«å¿…è¦ãªé¡ã‚’æ›´æ–°
            document.getElementById(`betAmount${playerNum}`).value = ""; // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
            updateDisplay(); // è¡¨ç¤ºã‚’æ›´æ–°
        }

        /**
         * ã€ŒFoldã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ãã®å‡¦ç†
         * @param {number} playerNum - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç•ªå· (0-3)
         */
        function fold(playerNum) {
            if (!gameStarted || playerFolded[playerNum]) return;
            playerFolded[playerNum] = true; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰çŠ¶æ…‹ã«ã™ã‚‹
            updateDisplay(); // è¡¨ç¤ºã‚’æ›´æ–°
        }

        /**
         * ã€Œã“ã®äººãŒå‹ã¡ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ãã®å‡¦ç†
         * @param {number} winnerNum - å‹è€…ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç•ªå· (0-3)
         */
        function declareWinner(winnerNum) {
            if (!gameStarted || playerFolded[winnerNum]) {
                alert("ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å‹è€…ã«ãªã‚Œã¾ã›ã‚“ã€‚");
                return;
            }
            const winnerName = playerNames[winnerNum] || `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${winnerNum + 1}`;
            
            // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
            if (confirm(`${winnerName} ãŒå‹ã¡ã§ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\nãƒãƒƒãƒˆã® ${totalPot} ãƒãƒƒãƒ—ãŒå…¨ã¦æ¸¡ã•ã‚Œã¾ã™ã€‚`)) {
                playerChips[winnerNum] += totalPot; // å‹è€…ã«ãƒãƒƒãƒˆã®ãƒãƒƒãƒ—ã‚’æ¸¡ã™
                alert(`${winnerName} ãŒ ${totalPot} ãƒãƒƒãƒ—ã‚’ç²å¾—ã—ã¾ã—ãŸï¼`);
                nextHand(); // æ¬¡ã®ãƒãƒ³ãƒ‰ã¸
            }
        }

        /**
         * ã€Œæ¬¡ã®ãƒãƒ³ãƒ‰ã¸ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ãã®å‡¦ç†ã€‚ãƒãƒ³ãƒ‰ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
         */
        function nextHand() {
            if (!gameStarted) return;
            // ãƒãƒ³ãƒ‰ã”ã¨ã®å¤‰æ•°ã‚’ãƒªã‚»ãƒƒãƒˆ
            totalPot = 0;
            currentBet = 0;
            raiseCount = 0;
            oyaIndex = -1;
            playerBets = Array(NUM_PLAYERS).fill(0);
            playerFolded = Array(NUM_PLAYERS).fill(false);
            updateDisplay(); // è¡¨ç¤ºã‚’æ›´æ–°
        }

        /**
         * ã‚²ãƒ¼ãƒ ã®è¡¨ç¤ºå…¨ä½“ï¼ˆãƒãƒƒãƒˆã€ãƒ†ãƒ¼ãƒ–ãƒ«ãªã©ï¼‰ã‚’æœ€æ–°ã®çŠ¶æ…‹ã«æ›´æ–°ã™ã‚‹
         */
        function updateDisplay() {
            // æƒ…å ±ãƒœãƒ¼ãƒ‰ã®æ•°å€¤ã‚’æ›´æ–°
            document.getElementById("totalPot").innerText = totalPot;
            document.getElementById("currentBet").innerText = currentBet;
            document.getElementById("raiseCount").innerText = raiseCount;
            
            // è¦ªã®è¡¨ç¤ºã‚’æ›´æ–°
            const oyaDisplay = document.getElementById("oyaDisplay");
            if (oyaIndex !== -1) {
                oyaDisplay.innerText = playerNames[oyaIndex] || `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${oyaIndex + 1}`;
            } else {
                oyaDisplay.innerText = "æœªé¸æŠ";
            }
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å†æç”»
            renderTable();
        }

        // æœ€åˆã«ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã¨ãã«ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ ã‚’æç”»ã™ã‚‹
        renderTable();
    </script>
</body>
</html>